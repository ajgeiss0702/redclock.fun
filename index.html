<html>
  <head>
    <title>Red Clock - Bell Countdown</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <link rel='stylesheet' href='/css/base.css'>


    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
      defer
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      defer
      ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
      defer
      ></script>

      <script src="/js/stylehelper.js" defer></script>
      <script src="/js/base.js"></script>
      <script src="/js/pageloader.js" defer></script>


    <link rel='icon' type="image/png" href='/img/red_clock.png'>
  </head>


  <body onload="rcf.emit('load')">
    <div id='scheduleloaderror' class='errorbox hidden'>
      The schedule could not be loaded. Try again later.
    </div>
    <div id='schoolselector'></div>
    <div id='countdown'></div>
  </body>


  <script>
  var rcf = {};
  rcf.on = function(name, func) {
    if(name == 'load' && rcf.loaded) {
      func();
      return;
    }
    this._subscriptions[name] = this._subscriptions[name] || [];
    this._subscriptions[name].push(func)
  }
  rcf.off = function(name, func){
    this._subscriptions[name] = this._subscriptions[name].filter(f=>f!==func)
  }
  rcf._subscriptions = {}
  rcf.emit = function(name, ...args){
    if(!this._subscriptions[name]){return; }
    this._subscriptions[name].forEach(f=>f(...args))
  }


  rcf.loaded = false;
  rcf.on('load', () => {
    rcf.loaded = true;
  });

  if(typeof localStorage.getItem('school') != 'undefined') {
    rcf.school = localStorage.getItem('school');
    rcf.schedule = localStorage.getItem('schedule');
  }

  httpGet('/api/schedule.php?school=list').then((a) => {
    try {
      rcf.schoolList = JSON.parse(a);
    } catch(e) {
      console.error(e);
      $('#scheduleloaderror').removeClass('hidden');
    }
  }).catch((e) => {
    console.error(e);
    $('#scheduleloaderror').removeClass('hidden');
    $('#scheduleloaderror').addClass('fadeIn');
  })
  </script>


</html>